{% extends "app/layout.html" %}
{% block content %}
<div class="modal-content" style="margin-top: 40px;">
<div>

    <div class="panel panel-default ">
      <div class="panel-heading">
        <div style="display: inline-block;">
           <h4>Publish your work</h4>
        </div>
        <div style="float: right;">
          <a href="/hub/projects">
             <button role="button" type="button" class="btn btn-default" style="padding: 3px 6px 6px 6px">
             <span class="glyphicon glyphicon-arrow-left" aria-hidden="true">Back to projects</span>
             </button>
             </a>
        </div>
      </div>

      <div class="panel-body" style="padding-left: 30px;">
        <p>Notebooks can be published as static (html) or as interactive (dashboard) documents. These documents are available at the
           <a href="{% url 'reports' %}" target="_blank" >Reports</a> section.
        </p>
        <hr>
        {% if notebooks|length > 0  %}
        <table class="table table-striped">
                <thead>
                <tr>
                <th>
                  Please select the notebook to publish as a new report:
                </th>
                </tr>
                </thead>
                <tbody>
                
                
                <form action="{% url 'notebook-publishform' %}" method="post" class="form-horizontal">
          {% csrf_token %}
          <div class="form-group">
          {% for nbfile in notebooks %}
          <tr><td>
             <input type="radio" name="ipynb_file" value="{{ nbfile.representation }}" {% if forloop.first %} checked {% endif %} > {{ nbfile.filename }} ({{ nbfile.volume }})<br>
          </td></tr>
          {% endfor %}
          </div>
                </td>
                </tr>
                </tbody>
                </table>



          <hr>
          <ul class="nav nav-tabs">
              <li class="active"><a href="#pane_desc" data-toggle="tab">Description</a></li>
              <li><a href="#pane_files" data-toggle="tab">Attach files</a></li>
              <li><a href="#pane_passwdNscope" data-toggle="tab">Password and scope</a></li>
              <li><a href="#pane_unpublish" data-toggle="tab">Unpublish</a></li>
          </ul>
          <div class="tab-content">
            <div id="pane_desc" class="tab-pane fade in active">
                 <div class="panel">
                 <div class="panel-heading">
                 </div>
                  <strong>Name of the report:</strong> <input type="text" name="report_name" /><br>
                  <strong>Description:</strong> <textarea rows="6" cols="100" id="report_description" name="report_description"></textarea>
                </div>
              </div>
              <div id="pane_files" class="tab-pane fade">
                {% if files %}
                <table class="table table-striped">
                <thead>
                <tr>
                <th>
                  Select those files to be attached to your report:
                </tr>
                </th>
                </thead>
                <tbody>
                <div class="form-group">
                  {% for file in files %}
                     <tr><td>
                     <input type="checkbox" name="other_files" value="{{ file.representation }}">
                     {% if file.isdir %}
                     <span class="glyphicon glyphicon-folder-open">
                     {% else %}
                     <span class="glyphicon glyphicon-file">
                     {% endif %}
                     {{ file.filename }} ({{ file.volume }})</span><br>
                     </td></tr>
                  {% endfor %}
                </div>
                </tbody>    
                </table>
                {% else %}
                <div class="alert alert-warning" role="alert">There are no files you can attach.</div>
                {% endif %}
              </div>
              <div id="pane_passwdNscope" class="tab-pane fade">
                <strong>Password:</strong> <input type="text" class="form-control" id="password" name="password" placeholder="Leave blank toyield unrestricted access" /><br>
                <strong>Scope:</strong> <select name = "scope" class = "btn btn-default">
                  {% for scope in scopes %}
                  <option value="{{ scope.name }}">{{ scope }}</option>
                  {% endfor %}
                </select>
              </div>
              <div id="pane_unpublish" class="tab-pane fade">
                {% if reports %}
                <strong>Tick to remove:</strong><br>
                  {% for r in reports %}
                  <input type="checkbox" name="report2remove" value="{{ r.id }}">[{{ r.pretty_ts }}] ({{ r }} - {{ r.scope }}) <br>
                  {% endfor %}
                {% else %}
                <div class="alert alert-warning" role="alert">There are no former reports of this project yet.</div>
                {% endif %}
              </div>
          </div>   <!-- tab-content -->

          <div class="well">
            <ul>
              <li>The url to the <strong>latest report:</strong> <code>{{ base_url }}{% url 'report-openlatest' %}?project_id={{ project_id }}&amp;name=<strong>reportname</strong></code>
              <li>If no <strong>Name</strong> is provided for the report, it is automatically generated from the noteboook's filename.
              <li>The reportname in the url should not contain any filename extension.
              <li>Public reports can be protected by a password if you provide one under the <strong>Password</strong> tab.
              <li>File attachments are deployed only with dashboard reports.
            </ul>
          </div>

          <div class="form-group">
            <div>
                 <input type="hidden" name="project_id" value="{{ project_id }}" />
                 <input type="hidden" id="reports2remove" name="reports2remove" value="" />
                 <input type="submit" name="html" value="Convert to html" class="btn btn-default" />
                 <input type="submit" name="dashboard" value="Deploy as dashboard" class="btn btn-default" onClick="return empty()" />
              <input type="submit" name="cancel" value="Cancel" class="btn btn-default" />
            </div>   <!-- col -->
          </div>     <!-- form-group -->
        </form>
        {% else %}              
        <div class="alert alert-warning" role="alert">There is nothing to publish yet. Notebook files (with ipynb filename extension) are searched in your git directory, the the share directory and in the shares without recursion.</div>
        {% endif %}
      </div>         <!-- panel-body -->
    </div>           <!-- panel -->
</div>               <!-- row -->
</div>

<script>
function empty() {
    var x;
    x = document.getElementById("password").value;
    if (x == "") {
        alert("Please enter a password.\nIt will have effect only at querying the report server...");
        return false;
    };
}
</script>

{% endblock %}
