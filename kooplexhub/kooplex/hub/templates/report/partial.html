{% if user_can_set %}
  {% for r in reports %}
    {% include 'report/settings.html' %}
  {% endfor %}
{% endif %}
{% with reports|first as report_latest %}
{% if report_latest.displaytype == 'Dashboard report' %}
<div class="panel panel-success ">
{% else %}
<div class="panel panel-default ">
{% endif %}
  <div class="panel-heading">
     <div class="row">
         <div class="col-md-1 col-sm-2">
            <a href="{% url 'report-open' %}?report_id={{ report_latest.id }}" target="_blank">
              <button type="button" class="btn btn-info"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"> </span> Open</button>
            </a>
         </div>

         <a data-toggle="collapse" href="#collapse{{ report_latest.id }}{{ pane }}" style="text-decoration: none; color: gray">
            <div class="col-md-11 col-sm-10">
              <span style="padding-left:20px;">
                <strong>{{ report_latest.name  }}</strong>
              </span>
              <span style="padding-left:20px">
                project name: <strong style="text-transform: uppercase;">{{ project.name }}</strong>,
                filename: <strong>{{ report_latest.filename_wo_ext }}</strong>,
                published on: <strong>{{ report_latest.pretty_ts }}</strong>
                {% if not user_can_set %}
                by {{ report_latest.creator.username }}
                {% endif %}
              </span>
              <span class="badge" style="float: right;">{{ report_latest.displaytype }}</span>
            </div>
         </a>

    </div>
  </div>
  <div id="collapse{{ report_latest.id }}{{ pane }}" class="panel-collapse collapse">
    <div class="panel-body">
      <div class="projects worksheet">
        <a href="{{ report_latest.url_ }}" target="_blank">
          <img src="{{ report_latest.picture }}"  style="max-height: 200px; max-width: 100%;">
        </a>
        <div class="well">
          <p><strong>Project description: </strong>{{ project.description }}
          <p><strong>Report description (latest): </strong>{{ report_latest.description }}
          <p><strong>Url to the latest report: </strong><code>{{ base_url }}{% url 'report-openlatest' %}?project_id={{ project.id }}&amp;filename={{ report_latest.filename_wo_ext }}</code>
        </div>
        <form action="{% url 'report-open' %}" method="post">
          {% csrf_token %}
          <label>Former reports</label>
          <select name='report_id' id='report_id{{ project.id }}' style="max-width: 800px;">
        {% for r in reports %}
          <option value="{{ r.id }}"
            {% if r.displaytype == "Dashboard report" %} style="background-color: lightgreen;" {% endif %}
          >[{{ r.pretty_ts }}] ({{ r.scope }})
          </option>
        {% endfor %}
          </select>
          <button type="submit" class="btn btn-info" data-toggle="tooltip" title="Open a former report" data-placement="top"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span></button>
      {% if pane == 'mine' %}
          <button type="button" class="btn btn-info" data-toggle="tooltip" title="Report settings" data-placement="top" onclick="settings({{ project.id }});"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span></button>
      {% endif  %}
        </form>
      </div>    <!-- projects -->
    </div>      <!-- panel body -->
  </div>        <!-- collapse -->
{% endwith %}
</div>        <!-- panel -->

<script type="text/javascript">
function settings(project_id) {
  var report_id;
  report_id = document.getElementById('report_id' + project_id).value;
  $('#report-settings-' + report_id).modal('show');
}
</script>
