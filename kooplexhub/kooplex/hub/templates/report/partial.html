{% for r in reports %}
  {% if r.is_configurable %}
    {% include 'report/settings.html' %}
  {% endif %}
  {% if r.ask_password %}
    {% include 'report/password.html' %}
  {% endif %}
{% endfor %}
{% with reports|first as report_latest %}
{% if report_latest.displaytype == 'Dashboard report' %}
<div class="panel panel-success ">
{% else %}
<div class="panel panel-default ">
{% endif %}
  <div class="panel-heading">
     <div class="row">
         <div class="col-md-1 col-sm-2">
            {% if report_latest.ask_password %}
            <a href="#" data-toggle="modal" data-target="#report-password-{{ report_latest.id  }}">
            {% else %}
            <a href="{% url 'report-open' report_id=report_latest.id %}" target="_blank">
            {% endif %}
              <button type="button" class="btn btn-info"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"> </span> Open</button>
            </a>
         </div>

         <a data-toggle="collapse" href="#collapse{{ report_latest.id }}" style="text-decoration: none; color: gray">
            <div class="col-md-11 col-sm-10">
              <span style="padding-left:20px;">
                <strong>{{ report_latest.name  }}</strong>
              </span>
              <span style="padding-left:20px" data-toggle="tooltip" title="Source filename of the latest report is {{ report_latest.notebook_filename }}" data-placement="bottom">
                project name: <strong style="text-transform: uppercase;">{{ project.name }}</strong>,
                published on: <strong>{{ report_latest.pretty_ts }}</strong>
                {% if not user_can_set %}
                by {{ report_latest.creator.username }}
                {% endif %}
              </span>
              <span class="badge" style="float: right;">{{ report_latest.displaytype }}</span>
            </div>
         </a>

    </div>
  </div>
  <div id="collapse{{ report_latest.id }}" class="panel-collapse collapse">
    <div class="panel-body">
      <div class="projects worksheet">
{% comment %}
        <a href="{{ report_latest.url_ }}" target="_blank">
          <img src="{{ report_latest.picture }}"  style="max-height: 200px; max-width: 100%;">
        </a>
{% endcomment %}
        <div class="well">
          <p><strong>Project description: </strong>{{ project.description }}
          <p><strong>Report description (latest): </strong>{{ report_latest.description }}
          <p><strong>Url to the latest report: </strong><code>{{ base_url }}{% url 'report-openlatest' project_owner=project.owner project_name=project.name report_name=report_latest.name %}</code>
        </div>
        <form id="list-{{ report_latest.id }}" action="" method="post">
          {% csrf_token %}
          <label>Former reports</label>
          <select name='report_id' id='report_key-{{ project.id }}-{{ reportname }}' style="max-width: 800px;">
        {% for r in reports %}
          <option value="{{ r.id }}"
            {% if r.displaytype == "Dashboard report" %} style="background-color: lightgreen;" {% endif %}
          >[{{ r.pretty_ts }}] ({{ r.scope }})
          </option>
        {% endfor %}
          </select>
          <button type="button" class="btn btn-info" data-toggle="tooltip" title="Open a former report" data-placement="top" onclick="password_pane('report_key-{{ project.id }}-{{ reportname }}', 'list-{{ report_latest.id }}');"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span></button>
        {% if report_latest.is_configurable %}
          <button type="button" class="btn btn-info" data-toggle="tooltip" title="Report settings" data-placement="top" onclick="settings_pane('report_key-{{ project.id }}-{{ reportname }}');"><span class="glyphicon glyphicon-wrench" aria-hidden="true"></span></button>
        {% endif  %}
        </form>
      </div>    <!-- projects -->
    </div>      <!-- panel body -->
  </div>        <!-- collapse -->
{% endwith %}
</div>        <!-- panel -->

<script type="text/javascript">
function settings_pane(key) {
  var report_id;
  report_id = document.getElementById(key).value;
  $('#report-settings-' + report_id).modal('show');
}
function password_pane(key, formid) {
  var report_id;
  report_id = document.getElementById(key).value;
  if (document.getElementById('report-password-' + report_id) == null) {
    document.getElementById(formid).submit();
  }
  $('#report-password-' + report_id).modal('show');
}
</script>
