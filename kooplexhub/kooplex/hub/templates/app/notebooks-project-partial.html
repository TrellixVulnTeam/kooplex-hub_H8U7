{% load custom_tags %}

<!--<div style="display:inline; width:128px; height:128px">
    {% if item.avatar_url %}
    <img src="{{ item.avatar_url }}" style="width:128px; height:128px" />
    {% endif %}
</div> -->

<div class=" col-md-12 col-sm-12 col-xs-12">
    {% if item.id in running  %}
        <div class="panel  panel-success">
        <div class="panel-heading ">
            <h4> <strong>{{ item.name }}</strong> </h4> Running {% if item.owner_username != username %} ( owned by {{ item.owner_username }} ) {%  endif  %}
    {% else %}
        <div class="panel panel-default ">
        <div class="panel-heading">
           <h4> <strong>{{ item.name }}</strong> </h4>{% if item.owner_username != username %} ( owned by {{ item.owner_username }} ) {%  endif  %}
    {% endif %}

            {% if 'forked_from_project' in item %} : forked from
                <a href="{{ base_url }}/gitlab/{{ item.forked_from_project.path_with_namespace }}" target="_blank">{{ item.forked_from_project.path_with_namespace }}</a>
            {% endif %}
        </div>

        <div class="panel-body">

                <div class=" col-md-3 col-sm-3 col-xs-12">
                    {{ item.description }}
                </div>

            <!-- CONTAINER RELATED STUFF -->

                <div class=" col-md-3 col-sm-3 col-xs-12">
                    <div class="row">
                        {% if not publicvar %}
                            {% if item.id in running  %}
                                <a href="{% url 'container-delete' %}?project_id={{ item.id }}" class="btn btn-danger" role="button">
                                <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span> Stop</a>

                            {% else %}
                                <a role="button" href="{% url 'container-start' %}?project_id={{ item.id }}{% if 'forked_from_project' in item %}&is_forked=True&project_id={{ item.id }}&target_id={{ item.forked_from_project.id }}{% else%}&is_forked=False{% endif %}">
                                <button role="button" type="button" class="btn btn-success" >
                                    <span class="glyphicon glyphicon-play" aria-hidden="true"></span> Start</button></a>

                            {% endif %}
                        {% endif %}

                        {% if item.id in running  %}
                            {% resolve sessions item.id as session %}


                            <a href="{{ session.external_url }}" target="_blank" class="btn btn-info" role="button">
                            <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> Open</a>
                            <a role="button" href="{% url 'notebooks-publishform' %}?project_id={{ item.id  }}">
                            <button role="button" type="button" class="btn btn-default">
                                <span class="glyphicon glyphicon-flag" aria-hidden="true"></span> Publish</button></a>

                        {% endif %}

                    {% if not publicvar %}
                        {% if item.id in running  %}
                            Using image:
                        {% else %}
                                <button type="button" class="btn btn-info" data-toggle="modal"  data-target="#change-image-{{ item.safename  }}">
                                    <span class="glyphicon glyphicon-hdd" aria-hidden="true"></span> Change image</button>
                                {% include 'app/notebooks-change-image.html' %}
                        {% endif %}
                            <p><strong> {{ item.image }}  </strong></p>

                    {% endif %}
                    </div>
                </div>

            <!-- GIT RELATED STUFF -->

                <div class=" col-md-4 col-sm-3 col-xs-12">
                    {%  if not publicvar %}
                        <div class="row">
                            <a role="button" href="{% url 'notebooks-commitform' %}?project_id={{ item.id }}">
                            <button role="button" type="button" class="btn btn-warning">
                                <span class="glyphicon glyphicon-save" aria-hidden="true"></span> Commit</button></a>

                            <!--<button type="button" class="btn btn-warning" data-toggle="modal" data-target="#repo-commit-{{ item.name }}">
                                <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> Commit </button>
                                 -->


                            {% comment %}
                            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#repo-pull-{{ item.name }}">
                                <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span> Restore</button>
                                {% include 'app/notebooks-revert.html' %}
                            {% endcomment %}
                            <a role="button" href="{% url 'notebooks-revertform' %}?project_id={{ item.id }}">
                            <button role="button" type="button" class="btn btn-info">
                                <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span> Restore</button></a>

                        </div>
                        {%  if  item.forks_count > 0 %}
                            <div class="row">
                            <p> See the opened <a href="{% url 'notebooks-mergerequestlist' %}?itemid={{ item.id }}&path_with_namespace={{ item.path_with_namespace }}" target="_blank">merge requests</a>    </p>
                            </div>
                        {% endif %}
                    {% endif %}

                    {%  if publicvar %}
                            <div class="row">
                                {% if item.forkable %}
                                    <a href="{% url 'project-fork' %}?itemid={{ item.id }}" target="_blank"><span class="btn btn-success">
                                        <span class="glyphicon glyphicon-magnet" aria-hidden="true"></span> Fork it</span> </a>
                                {% else %}
                                     <button role="button" type="button" class="btn btn-warning">it has been forked</button>
                                {% endif %}
                            </div>
                    {%  endif %}

            </div>

            <!-- PROJECT RELATED STUFF -->

                <div class=" col-md-2 col-sm-2 col-xs-3">
                    {% if not publicvar %}
                        {% if item.id not in running  %}
                        {% include 'app/notebooks-delete-project.html' %}
                        <button type="button" class="btn btn-danger" data-toggle="modal"  data-target="#delete-project-{{ item.id }}">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete project</button>
                    {% endif %}
                {% endif %}
                </div>

            </div>
            </div>




</div>

