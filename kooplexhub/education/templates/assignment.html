{% extends "layout.html" %}
{% load render_table from django_tables2 %}

{% load static %}

{% block css_extra %}
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap-datetimepicker-master/css/bootstrap-datetimepicker.min.css' %}">
{% endblock %}


{% block submenu %}
{% include 'education_submenu.html' with title="Your assignments" submenu="assignment" %}
{% endblock %}
{% load render_table from django_tables2 %}

{% block main_content_right %}
  <h6>Assignments you can manage</h6>

<ul class="nav nav-tabs" id="assignmentConfigTabs" role="tablist">
  <li class="nav-item" role="presentation">
  {% if f_assignment %}
    <button class="nav-link {% if active_tab == "tab-new" %}active{% endif %}" id="tab-new" data-bs-toggle="tab" data-bs-target="#newAssignment" type="button" role="tab" aria-controls="newAssignment" aria-selected="{% if active_tab == "tab-new" %}true{% else %}false{% endif %}">New</button>
  {% else %}
    <button class="nav-link disabled" id="new-tab" data-bs-toggle="tab" data-bs-target="#newAssignment" type="button" role="tab" aria-controls="newAssignment" aria-selected="false">New</button>
  {% endif %}
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-conf" %}active{% endif %}" id="tab-conf" data-bs-toggle="tab" data-bs-target="#confAssignment" type="button" role="tab" aria-controls="confAssignment" aria-selected="{% if active_tab == "tab-conf" %}true{% else %}false{% endif %}">Configure</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-collectmass" %}active{% endif %}" id="tab-collectmass" data-bs-toggle="tab" data-bs-target="#massAssignment" type="button" role="tab" aria-controls="massAssignment" aria-selected="{% if active_tab == "tab-collectmass" %}true{% else %}false{% endif %}">Mass</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-collectindividual" %}active{% endif %}" id="tab-collectindividual" data-bs-toggle="tab" data-bs-target="#individualAssignment" type="button" role="tab" aria-controls="individualAssignment" aria-selected="{% if active_tab == "tab-collectindividual" %}true{% else %}false{% endif %}">Individual</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-summary" %}active{% endif %}" id="tab-summary" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab" aria-controls="summary" aria-selected="{% if active_tab == "tab-summary" %}true{% else %}false{% endif %}">Summary</button>
  </li>
</ul>
<div class="tab-content" id="assignmentTabContent">
  {% if f_assignment.okay %}
  <div class="tab-pane fade {% if active_tab == "tab-new" %}show active{% endif %}" id="newAssignment" role="tabpanel" aria-labelledby="tab-new">
    <form id="assignments-form-new" class="form-horizontal" action="{% url 'education:newassignment' %}" method="post">
      {% csrf_token %}
      <input type="hidden" name="course_id" value="{{ f_assignment.course.id }}">
        <div style="position: relative">
          <table>
            <tr><th><label for="course_name">Course:</label></th><td>{{ f_assignment.course.name }}</td></tr>
            {{ f_assignment.as_table }}
          </table>
        </div>
    {% include 'apply_cancel.html' %}
    </form>
  </div>
  {% else %}
  <div class="tab-pane fade {% if active_tab == "tab-new" %}show active{% endif %}" id="newAssignment" role="tabpanel" aria-labelledby="tab-new">
      <div class="alert alert-warning">There are no candidate subfolders in <code>{{ f_assignment.folder_usercontainer }}</code> directory. Please create one and place all files into it to be part of a new assignment. Empty folders cannot be selected.</div>
  </div>
  {% endif %}
  <div class="tab-pane fade {% if active_tab == "tab-conf" %}show active{% endif %}" id="confAssignment" role="tabpanel" aria-labelledby="tab-conf">
	  <h6>Delete or refresh assignments in course {{ course.name }}</h6>
	  <form id="assignments-configform" class="form-horizontal" action="{% url 'education:configureassignment' %}" method="post">
      {% csrf_token %}
	  {% render_table t_assignment_config %}
    {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active_tab == "tab-collectindividual" %}show active{% endif %}" id="individualAssignment" role="tabpanel" aria-labelledby="tab-collectindividual">
	  <h6>Collect, feedback or reassign assignments</h6>
    <form id="assignments-collectform" class="form-horizontal" action="{% url 'education:handleassigment' %}" method="post">
      {% csrf_token %}
	  {% render_table t_assignment_individual %}
    {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active_tab == "tab-collectmass" %}show active{% endif %}" id="massAssignment" role="tabpanel" aria-labelledby="tab-collectmass">
	  <h6>Collect assignments</h6>
    <form id="massassignments-collectform" class="form-horizontal" action="{% url 'education:massassignment' %}" method="post">
      {% csrf_token %}
	  {% render_table t_assignment_mass %}
    {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active_tab == "tab-summary" %}show active{% endif %}" id="summary" role="tabpanel" aria-labelledby="tab-summary">
	  <h6>Summary</h6>
	  {% render_table t_assignment_summary %}
  </div>
</div>


<script
  type="text/javascript"
  src="{% static 'bootstrap-datetimepicker-master/js/bootstrap-datetimepicker.min.js' %}"
></script>
<script>
  function set_search(tab) {
    if (tab == "tab-conf") {
      $("#search_field").attr("placeholder",  "Search course or assignment")
      $("#search_field").attr("value", $("#s_assignment_config").attr("value") )
      $("#search_field").attr("disabled", false )
    } else if (tab == "tab-collectmass") {
      $("#search_field").attr("placeholder",  "Search course or assignment")
      $("#search_field").attr("value", $("#s_assignment_mass").attr("value") )
      $("#search_field").attr("disabled", false )
    } else if (tab == "tab-collectindividual") {
      $("#search_field").attr("placeholder",  "Search user, course or assignment")
      $("#search_field").attr("value", $("#s_assignment_individual").attr("value") )
      $("#search_field").attr("disabled", false )
    } /*else if (tab == "tab-summary") {
      $("#search_field").attr("placeholder",  "Search")
      $("#search_field").attr("value", "" )
      $("#search_field").attr("disabled", true )
    }*/ else {
      $("#search_field").attr("placeholder",  "Search")
      $("#search_field").attr("value", "" )
      $("#search_field").attr("disabled", true )
    }
  }

  $( document ).ready(function() {
      console.log( "ready: {{ active_tab }}" );
      set_search("{{ active_tab }}")
      $('.datetimepicker').datetimepicker('hide');
  });

  $("#assignmentConfigTabs>li>button").on("click", function () {
    var tab = $( this ).attr("id")
    $.cookie("active_tab", tab, { 'path': '/', 'secure': true })
    console.log( "tab: " + tab )
    set_search(tab)
  })

  function set_checkbox(x) { 
    console.log('set checkbox? ' + x);	
    $('#'+x).prop("checked", true); 
  }
</script>
{% endblock %}

{% block navsearch %}
<form class="d-flex" action="{% url 'education:search' usercoursebinding_id %}" method="get">
  {#% csrf_token %#}
  <input type="hidden" id="s_assignment_config" value="{{ user.profile.search_education_assignment_config }}">
  <input type="hidden" id="s_assignment_mass" value="{{ user.profile.search_education_assignment_mass }}">
  <input type="hidden" id="s_assignment_individual" value="{{ user.profile.search_education_assignment_individual }}">
  <input class="form-control me-2" type="search" id="search_field" name="pattern"
      value="" placeholder="Search" disabled
      aria-label="Search">
  <button class="btn btn-outline-secondary" type="submit" name="button" value="search">Search</button>
</form>
{% endblock %}

