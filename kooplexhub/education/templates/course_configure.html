{% extends "education_layout.html" %}
{% load render_table from django_tables2 %}
{% load extras %}

{% block head_content %}
<style>
.mytab{
  color: rgb(196, 196, 196);
}
.mytab:hover{
  color: rgb(196, 196, 196);
  font-weight: bolder;
}
.mytab.active {
  font-weight: bolder;
}
</style>
{% endblock %}

{% block realcontent %}
<div class="card shadow p-3 mb-5 bg-light rounded">
  {% title "You are now configuring <em>" course.name "</em> course" %}

<ul class="nav nav-tabs" id="courseConfigTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <a class="nav-link mytab {% if active == "conf" %}active{% endif %}" id="tab-conf" data-bs-toggle="tab" href="#configureCourse" role="tab" aria-controls="configureCourse" aria-selected="{% if active == "conf" %}true{% else %}false{% endif %}">Configure</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link mytab {% if active == "teacher" %}active{% endif %}" id="tab-teacher" data-bs-toggle="tab" href="#addteachersCourse" role="tab" aria-controls="addteachersCourse" aria-selected="{% if active == "teacher" %}true{% else %}false{% endif %}">Teachers</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link mytab {% if active == "student" %}active{% endif %}" id="tab-student" data-bs-toggle="tab" href="#addstudentsCourse" role="tab" aria-controls="addstudentsCourse" aria-selected="{% if active == "student" %}true{% else %}false{% endif %}">Students</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link mytab {% if active == "group" %}active{% endif %}" id="tab-group" data-bs-toggle="tab" href="#courseGroup" role="tab" aria-controls="confCourseGropu" aria-selected="{% if active == "group" %}true{% else %}false{% endif %}">Groups</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link mytab {% if active == "grpstudent" %}active{% endif %}" id="tab-grpstudent" data-bs-toggle="tab" href="#groupStudent" role="tab" aria-controls="groupStudent" aria-selected="{% if active == "grpstudent" %}true{% else %}false{% endif %}">Group of students</a>
  </li>
</ul>
<div class="tab-content  mt-2" id="courseConfigTabsContent">
  <div class="tab-pane  mt-2 fade {% if active == "conf" %}show active{% endif %}" id="configureCourse" role="tabpanel" aria-labelledby="tab-conf">
    <form id="courseSettingsForm" class="form-horizontal  mt-2" action="{% url 'education:configure' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {{ courseform }}
      <div class="alert alert-warning mt-2 mb-2" role="alert">If you decide to change the image, do not forget to restart the course container to take effect and notify your students to do so as well.</div>
      {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane mt-2 fade {% if active == "group" %}show active{% endif %}" id="courseGroup" role="tabpanel" aria-labelledby="tab-group">
    <form id="groupSettingsAdd" class="form-horizontal" action="{% url 'education:newgroup' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {{ groupform }}
      <div class="mt-2 mb-2">
      {% include 'apply_cancel.html' %}
    </div>
    </form>
    {% if t_group.data|length > 0 %}
    <form id="groupSettings" class="form-horizontal" action="{% url 'education:configuregroup' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {% render_table t_group %}
      {% include 'apply_cancel.html' %}
    </form>
    {% endif %}
  </div>
  <div class="tab-pane fade {% if active == "teacher" %}show active{% endif %}" id="addteachersCourse" role="tabpanel" aria-labelledby="tab-teacher">
    <form id="courseAddTeacherForm" class="form-horizontal" action="{% url 'education:addteacher' usercoursebinding_id %}" method="post">
      <input class="form-control me-2 mb-3 mt-3" type="text" id="search_studenttwo" placeholder="Search student" title="Type in a name" autofocus>
      {% csrf_token %}
      {% render_table t_teacher %}
      {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active == "student" %}show active{% else %}false{% endif %}" id="addstudentsCourse" role="tabpanel" aria-labelledby="tab-student">
    <form id="courseAddStudentForm" class="form-horizontal" action="{% url 'education:addstudent' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      <h4 class="mt-2 mb-4">Student management</h4>
      <h6>Shortcut:</h6>
      Remove all student from courses by clicking once here: <button type="submit" class="btn btn-danger" name="button" value="reset" onclick="return confirm('Are you sure?');">Reset</button> 
      <h6 class="mt-4">Manage individually by student:</h6>
      <input class="form-control me-2 mb-3 mt-3" type="text" id="search_student" placeholder="Search student" title="Type in a name" autofocus>
      {% render_table t_student %}
      {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active == "grpstudent" %}show active{% else %}false{% endif %}" id="groupStudent" role="tabpanel" aria-labelledby="tab-grpstudent">
    <form id="groupSettingsChoose" class="form-horizontal" action="{% url 'education:groupstudent' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {% include 'drag_and_drop.html' %}
      {% include 'apply_cancel.html' %}
    </form>
  </div>
</div>
</div>

<script>
$("#courseConfigTabs li a").on("click", function () {
  var tab = $( this ).attr("id").split('-')[1]
  console.log( tab )
  $.cookie("configure_course_tab", tab, { 'path': '/', 'secure': true });
});
$("input[id^='u-'").on("click", function() {
  console.log( this )
  var lbl = $("#lbl_" + $(this).attr("id"))
  if( $( this ).is(':checked') ) {
    lbl.text("Add")
    $(this).css('background-color', "rgb(13, 253, 110)")
  } else {
    lbl.text("Skip")
    $(this).css('background-color', "rgb(255, 255, 255)")
  }
})

$("input[id^='ur-'").on("click", function() {
  console.log( this )
  console.log(  $(this).css('background-color') )
  var lbl = $("#lbl_" + $(this).attr("id"))
  if( $( this ).is(':checked') ) {
    lbl.text("Added")
    $(this).css('background-color', "rgb(13, 110, 253)")
  } else {
    lbl.text("Remove")
    $(this).css('background-color', "rgb(253, 110, 13)")
  }
})

$("#search_student").keyup(function() {
  var pattern = $( this ).val().toUpperCase();
  console.log( "search student: " + pattern );
  $( "#courseAddStudentForm" ).find('tr').each(function() {
    if ( $( this ).parent().is("thead") ) {
      return;
    }
    var hide_it = true;
    if (pattern.length > 0) {
      $( this ).find("input[name='search_student'").each(function() {
        var name = $( this ).val().toUpperCase();
        if ( name.indexOf(pattern) > -1 ) {
	  hide_it = false;
        }
      });
    } else {
      hide_it = false;
    }
    if (hide_it) {
      $( this ).hide();
    } else {
      $( this ).show();
    }
  });
});

$("#search_studenttwo").keyup(function() {
  var pattern = $( this ).val().toUpperCase();
  console.log( "search student: " + pattern );
  $( "#courseAddTeacherForm" ).find('tr').each(function() {
    if ( $( this ).parent().is("thead") ) {
      return;
    }
    var hide_it = true;
    if (pattern.length > 0) {
      $( this ).find("input[name='search_studenttwo'").each(function() {
        var name = $( this ).val().toUpperCase();
        if ( name.indexOf(pattern) > -1 ) {
    hide_it = false;
        }
      });
    } else {
      hide_it = false;
    }
    if (hide_it) {
      $( this ).hide();
    } else {
      $( this ).show();
    }
  });
});
</script>
{% endblock %}

