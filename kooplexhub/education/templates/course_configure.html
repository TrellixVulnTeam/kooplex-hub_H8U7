{% extends "layout.html" %}
{% load render_table from django_tables2 %}

{% block submenu %}
{% include 'education_submenu.html' with title="Configure course" submenu="configure" %}
{% endblock %}

{% block main_content_right %}

<ul class="nav nav-tabs" id="courseConfigTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-conf" %}active{% endif %}" id="tab-conf" data-bs-toggle="tab" data-bs-target="#configureCourse" type="button" role="tab" aria-controls="configureCourse" aria-selected="{% if active_tab == "tab-conf" %}true{% else %}false{% endif %}">Configure</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-group" %}active{% endif %}" id="tab-group" data-bs-toggle="tab" data-bs-target="#courseGroup" type="button" role="tab" aria-controls="confCourseGropu" aria-selected="{% if active_tab == "tab-group" %}true{% else %}false{% endif %}">Groups</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-teacher" %}active{% endif %}" id="tab-teacher" data-bs-toggle="tab" data-bs-target="#addteachersCourse" type="button" role="tab" aria-controls="addteachersCourse" aria-selected="{% if active_tab == "tab-teacher" %}true{% else %}false{% endif %}">Teachers</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-student" %}active{% endif %}" id="tab-student" data-bs-toggle="tab" data-bs-target="#addstudentsCourse" type="button" role="tab" aria-controls="addstudentsCourse" aria-selected="{% if active_tab == "tab-student" %}true{% else %}false{% endif %}">Students</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab == "tab-grpstudent" %}active{% endif %}" id="tab-grpstudent" data-bs-toggle="tab" data-bs-target="#groupStudent" type="button" role="tab" aria-controls="groupStudent" aria-selected="{% if active_tab == "tab-grpstudent" %}true{% else %}false{% endif %}">Group students</button>
  </li>
</ul>
<div class="tab-content" id="courseConfigTabsContent">
  <div class="tab-pane fade {% if active_tab == "tab-conf" %}show active{% endif %}" id="configureCourse" role="tabpanel" aria-labelledby="tab-conf">
    <form id="courseSettingsForm" class="form-horizontal" action="{% url 'education:configure' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {{ courseform }}
      <div class="alert alert-warning" role="alert">If you decide to change the image. Do not forget to restart the course container to take effect and notify your students to do so as well.</div>
      {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active_tab == "tab-group" %}show active{% endif %}" id="courseGroup" role="tabpanel" aria-labelledby="tab-group">
    <form id="groupSettingsAdd" class="form-horizontal" action="{% url 'education:newgroup' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {{ groupform }}
      {% include 'apply_cancel.html' %}
    </form>
    <form id="groupSettings" class="form-horizontal" action="{% url 'education:configuregroup' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {% render_table t_group %}
      {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active_tab == "tab-teacher" %}show active{% endif %}" id="addteachersCourse" role="tabpanel" aria-labelledby="tab-teacher">
    <form id="courseAddTeacherForm" class="form-horizontal" action="{% url 'education:addteacher' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {% render_table t_teacher %}
      {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active_tab == "tab-student" %}show active{% else %}false{% endif %}" id="addstudentsCourse" role="tabpanel" aria-labelledby="tab-student">
    <form id="courseAddStudentForm" class="form-horizontal" action="{% url 'education:addstudent' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      <h6>Shortcuts</h6>
      <button type="submit" class="btn btn-danger" name="button" value="reset" onclick="return confirm('Are you sure?');">Reset</button> Remove all student from this course at one click.
      <h6>Table</h6>
      {% render_table t_student %}
      {% include 'apply_cancel.html' %}
    </form>
  </div>
  <div class="tab-pane fade {% if active_tab == "tab-grpstudent" %}show active{% else %}false{% endif %}" id="groupStudent" role="tabpanel" aria-labelledby="tab-grpstudent">
    <form id="groupSettingsChoose" class="form-horizontal" action="{% url 'education:groupstudent' usercoursebinding_id %}" method="post">
      {% csrf_token %}
      {% include 'drag_and_drop.html' %}
      {% include 'apply_cancel.html' %}
    </form>
  </div>
</div>

<script>
  function set_search(tab) {
    if (tab == "tab-teacher") {
      $("#search_field").attr("placeholder",  "Search name or coursecode")
      $("#search_field").attr("value", $("#s_teacher").attr("value") )
      $("#search_field").attr("disabled", false )
    } else if (tab == "tab-student") {
      $("#search_field").attr("placeholder",  "Search name or coursecode")
      $("#search_field").attr("value", $("#s_student").attr("value") )
      $("#search_field").attr("disabled", false )
    } /* else if (tab == "tab-group") {
      $("#search_field").attr("placeholder",  "Search")
      $("#search_field").attr("value", "" )
      $("#search_field").attr("disabled", true )
    } */ else {
      $("#search_field").attr("placeholder",  "Search")
      $("#search_field").attr("value", "" )
      $("#search_field").attr("disabled", true )
    }
  }

  $( document ).ready(function() {
      console.log( "ready: {{ active_tab }}" );
      set_search("{{ active_tab }}")
  });

  $("#courseConfigTabs>li>button").on("click", function () {
    var tab = $( this ).attr("id")
    $.cookie("active_tab", tab, { 'path': '/', 'secure': true })
    console.log( "tab: " + tab )
    set_search(tab)
  })
</script>
{% endblock %}

{% comment %}
{% block main_content_left %}
  {#% include 'project/hint_join.html' %#}
{% endblock %}
{% endcomment %}

{% block navsearch %}
<form class="d-flex" action="{% url 'education:search' usercoursebinding_id %}" method="get">
  {#% csrf_token %#}
  <input type="hidden" id="s_student" value="{{ user.profile.search_education_student }}">
  <input type="hidden" id="s_teacher" value="{{ user.profile.search_education_teacher }}">
  <input class="form-control me-2" type="search" id="search_field" name="pattern"
      value="" placeholder="Search" disabled
      aria-label="Search">
  <button class="btn btn-outline-secondary" type="submit" name="button" value="search">Search</button>
</form>
{% endblock %}
