{% extends "container_layout.html" %}
{% load render_table from django_tables2 %}
{% load extras %}

{% block head_content %}
<style>
.mytab{
  color: rgb(196, 196, 196);
}
.mytab:hover{
  color: rgb(196, 196, 196);
  font-weight: bolder;
}
.mytab.active {
  font-weight: bolder;
}
</style>
{% endblock %}

{% block realcontent %}
<div class="card shadow p-3 mb-5 bg-light rounded">
<form id="container-manage" class="form-horizontal" action="{% url 'container:configure_save' %}" method="post">
{% csrf_token %}
  {% title_with_button "You are now configuring <em>" container.friendly_name "</em> environment" %}
  <input type="hidden" name="container_id" value="{{ container.id }}">
  <ul class="nav nav-tabs" id="serviceConfigTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link mytab {% if active == "image" %}active{% endif %}" id="tab-image" data-bs-toggle="tab" href="#image" role="tab" aria-controls="image" aria-selected="{% if active == "image" %}true{% else %}false{% endif %}">Name/Image</a>
    </li>
{% if app_project_installed %}
    <li class="nav-item" role="presentation">
      <a class="nav-link mytab {% if active == "projects" %}active{% endif %}" id="tab-projects" data-bs-toggle="tab" href="#projects" role="tab" aria-controls="projects" aria-selected="{% if active == "projects" %}true{% else %}false{% endif %}">Projects</a>
    </li>
{% endif %}
{% if app_education_installed %}
    <li class="nav-item" role="presentation">
      <a class="nav-link mytab {% if active == "courses" %}active{% endif %}" id="tab-courses" data-bs-toggle="tab" href="#courses" role="tab" aria-controls="courses" aria-selected="{% if active == "courses" %}true{% else %}false{% endif %}">Courses</a>
    </li>
{% endif %}
    <li class="nav-item" role="presentation">
      <a class="nav-link mytab {% if active == "attachments" %}active{% endif %}" id="tab-attachments" data-bs-toggle="tab" href="#attachments" role="tab" aria-controls="attachments" aria-selected="{% if active == "attachments" %}true{% else %}false{% endif %}">Attachments</a>
    </li>
{% if app_volume_installed %}
    <li class="nav-item" role="presentation">
      <a class="nav-link mytab {% if active == "volumes" %}active{% endif %}" id="tab-volumes" data-bs-toggle="tab" href="#volumes" role="tab" aria-controls="volumes" aria-selected="{% if active == "volumes" %}true{% else %}false{% endif %}">Volume</a>
    </li>
{% endif %}
{% if app_plugin_installed %}
    <li class="nav-item" role="presentation">
      <a class="nav-link {% if active == "filesync" %}active{% endif %}" id="tab-filesync" data-bs-toggle="tab" href="#filesync" role="tab" aria-controls="filesync" aria-selected="{% if active == "filesync" %}true{% else %}false{% endif %}">Synchronized files</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link {% if active == "versioncontrol" %}active{% endif %}" id="tab-versioncontrol" data-bs-toggle="tab" href="#versioncontrol" role="tab" aria-controls="versioncontrol" aria-selected="{% if active == "versioncontrol" %}true{% else %}false{% endif %}">Version control</a>
    </li>
{% endif %}
  </ul>

  <div class="tab-content" id="serviceConfigTabContent">
    <div class="tab-pane fade {% if active == "image" %}show active{% endif %}" id="image" role="tabpanel" aria-labelledby="tab-image">
      <div class="container-fluid d-flex flex-row">
        <div class="d-flex mt-3">
          <table>
  {{ form.as_table }}
          </table>
        </div>
        <div class="d-flex ms-3 w-100 w-md-50">
          <div ata-toggle="tooltip" title="Please select an option from the image dropdown to check its description."  class="d-flex bg-warning rounded p-2 w-100 mt-2 mt-md-0">
            <p class="fw-bolder">Image description:&nbsp;</p>
            <p id="imageDescription"></p>
          </div>
	{{ form.descriptions }}
        </div>
      </div>
    </div>

    <div class="tab-pane fade {% if active == "attachments" %}show active{% endif %}" id="attachments" role="tabpanel" aria-labelledby="tab-attachments">
      {% render_table t_attachments %}
    </div>

{% if app_project_installed %}
    <div class="tab-pane fade {% if active == "projects" %}show active{% endif %}" id="projects" role="tabpanel" aria-labelledby="tab-projects">
      {# fixme: add project search bar #}
      {% render_table t_projects %}
    </div>
{% endif %}
    
{% if app_education_installed %}
    <div class="tab-pane fade {% if active == "courses" %}show active{% endif %}" id="courses" role="tabpanel" aria-labelledby="tab-coursess">
      {% render_table t_courses %}
    </div>
{% endif %}

{% if app_volume_installed %}
    <div class="tab-pane fade {% if active == "volumes" %}show active{% endif %}" id="volumes" role="tabpanel" aria-labelledby="tab-volumes">
      {% render_table t_volumes %}
    </div>
{% endif %}
	    {% comment %}
    <div class="tab-pane fade {% if active == "volumes" %}show active{% endif %}" id="volumes" role="tabpanel" aria-labelledby="tab-volumes">
	    ...
    </div>
	    {% endcomment %}

{% if app_plugin_installed %}
    <div class="tab-pane fade {% if active == "filesync" %}show active{% endif %}" id="filesync" role="tabpanel" aria-labelledby="tab-filesync">
      <h5 class="card-title">Select synchronized libraries to associate with the service environment</h5>
      {% render_table t_synclibs %}
    </div>

    <div class="tab-pane fade {% if active == "versioncontrol" %}show active{% endif %}" id="versioncontrol" role="tabpanel" aria-labelledby="tab-vc">
      <h5 class="card-title">Select version control repositores to associate with the service environment</h5>
      {% render_table t_repositories %}
    </div>
{% endif %}
  </div>

</form>
</div>

<script>
$("#serviceConfigTabs li a").on("click", function () {
  var tab = $( this ).attr("id").split('-')[1]
  console.log( tab )
  $.cookie("configure_env_tab", tab, { 'path': '/', 'secure': true });
});
$("select[name='image'").change(function() {
    $( "select option:selected" ).each(function() {
        var id = $(this).attr("value");
        console.log( $( this ).text() + " -> " + id);
	if (id === "") {
	    $("#imageDescription").text("");
	} else {
	    var description = $("#image-description-" + id).attr("value");
	    $("#imageDescription").text(description);
	}
    });
}).change();
$("input[name='attach'").change(function() {
  var icon;
	console.log( this ) ;
  if ( $( this ).is(":checked") ) {
    icon = "oi-envelope-open";
  } else {
    icon = "oi-envelope-closed";
  }
  $( this ).parent().children("label").children("i").attr("class", "oi " + icon);
});
$("input[name='attach-project'").change(function() {
  var icon;
	console.log( this ) ;
  if ( $( this ).is(":checked") ) {
    icon = "bi-patch-plus";
  } else {
    icon = "bi-patch-minus";
  }
  $( this ).parent().children("label").children("i").attr("class", "bi " + icon);
});
$("input[name='attach-course'").change(function() {
  var icon;
	console.log( this ) ;
  if ( $( this ).is(":checked") ) {
    icon = "bi-patch-plus";
  } else {
    icon = "bi-patch-minus";
  }
  $( this ).parent().children("label").children("i").attr("class", "bi " + icon);
});
$("input[name='volume'").change(function() {
  var icon;
	console.log( this ) ;
  if ( $( this ).is(":checked") ) {
    icon = "bi-file-earmark-check";
  } else {
    icon = "bi-file-earmark";
  }
  $( this ).parent().children("label").children("i").attr("class", "bi " + icon);
});
</script>
{% endblock %}

